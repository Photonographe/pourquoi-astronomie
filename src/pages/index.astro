---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import SearchBar from '../components/SearchBar.astro';
import CategoryCard from '../components/CategoryCard.astro';
import QuestionItem from '../components/QuestionItem.astro';
import FunFact from '../components/FunFact.astro';
import Footer from '../components/Footer.astro';
import { categories, getAllQuestions, getQuestionsByCategory } from '../data/questions.ts';

// Get featured questions (one from each category)
const allQuestions = await getAllQuestions();
const featuredQuestions = [];

for (const category of categories) {
  const categoryQuestions = await getQuestionsByCategory(category.id);
  if (categoryQuestions.length > 0) {
    featuredQuestions.push(categoryQuestions[0]);
  }
}

const totalQuestions = allQuestions.length;
---

<Layout 
  title="Accueil" 
  description="Découvre les mystères de l'univers ! Site éducatif d'astronomie pour enfants avec des réponses simples aux questions sur l'espace, les planètes et les étoiles."
>
  <!-- Skip link for accessibility -->
  <a href="#main-content" class="skip-link">Aller au contenu principal</a>
  
  <Header />
  
  <main id="main-content">
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-background">
        <div class="stars-container" id="starsContainer"></div>
      </div>
      
      <div class="hero-content">
        <h1 class="hero-title">Découvre les mystères de l'univers !</h1>
        <p class="hero-subtitle">
          Pose toutes tes questions sur l'espace, les planètes, les étoiles et bien plus encore...
        </p>
        
        <div class="hero-stats">
          <div class="stat">
            <span class="stat-number">{totalQuestions}+</span>
            <span class="stat-label">Questions répondues</span>
          </div>
          <div class="stat">
            <span class="stat-number">{categories.length}</span>
            <span class="stat-label">Catégories</span>
          </div>
          <div class="stat">
            <span class="stat-number">100%</span>
            <span class="stat-label">Sources fiables</span>
          </div>
        </div>
        
        <SearchBar />
        
        <FunFact animated={true} />
      </div>
    </section>
    
    <!-- Categories Section -->
    <section class="categories-section">
      <div class="container">
        <h2 class="section-title">Explore par catégorie</h2>
        <p class="section-subtitle">
          Choisis ton domaine préféré et découvre toutes les merveilles de l'astronomie !
        </p>
        
        <div class="categories-grid">
          {categories.map((category, index) => (
            <CategoryCard 
              category={category} 
              featured={index === 0}
            />
          ))}
        </div>
      </div>
    </section>
    
    <!-- Featured Questions Section -->
    <section class="featured-questions">
      <div class="container">
        <h2 class="section-title">Questions populaires</h2>
        <p class="section-subtitle">
          Découvre les questions les plus fascinantes de nos jeunes astronomes !
        </p>
        
        <div class="questions-grid">
          {featuredQuestions.map((question, index) => (
            <QuestionItem question={question} index={index} />
          ))}
        </div>
        
        <div class="cta-section">
          <a href="/search" class="cta-button">
            Voir toutes les questions
          </a>
        </div>
      </div>
    </section>
    
    <!-- Call to Action -->
    <section class="cta-banner">
      <div class="container">
        <h2>Une question qui te trotte dans la tête ?</h2>
        <p>Utilise notre recherche pour trouver la réponse, ou explore nos catégories !</p>
        <div class="cta-buttons">
          <a href="/search" class="btn btn-primary">Rechercher une question</a>
          <a href="/about" class="btn btn-secondary">En savoir plus</a>
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
</Layout>

<!-- Styles identiques à avant -->
<style>
  /* ... gardez tous les styles existants ... */
</style>

<!-- Scripts identiques à avant -->
<script>
  /* ... gardez tous les scripts existants ... */
</script>
